{
 parserClass="io.github.josehsantos.hack.lang.HackParser"
  parserUtilClass="io.github.josehsantos.hack.lang.parser.HackParserUtil"

  extends="com.intellij.extapi.psi.ASTWrapperPsiElement"

  psiClassPrefix="Hack"
  psiImplClassSuffix="Impl"
  psiPackage="io.github.josehsantos.hack.lang.psi"
  psiImplPackage="io.github.josehsantos.hack.lang.psi.impl"

  elementTypeHolderClass="io.github.josehsantos.hack.lang.psi.HackTypes"
  elementTypeClass="io.github.josehsantos.hack.lang.HackTokenType"
  tokenTypeClass="io.github.josehsantos.hack.lang.HackTokenType"

  tokens=[
     T_SEMICOLON = ";"
     T_COLON = ":"
     T_COMMA = ","
     T_DOT = "."
     T_LBRACKET = "["
     T_RBRACKET = "]"
     T_LPAREN = "("
     T_RPAREN = ")"
     T_LBRACE = "{"
     T_RBRACE = "}"
     T_OR = "|"
     T_XOR = "^"
     T_AND = "&"
     T_PLUS = "+"
     T_MINUS = "-"
     T_MUL = "*"
     T_DIV = "/"
     T_EQUAL = "="
     T_MOD = "%"
     T_NEGATE = "!"
     T_NOT = "~"
     T_LESS = "<"
     T_GREATER = ">"
     T_QUEST = "?"
     T_SILENCE = "@"
     T_SINGLE_QUOTE = "'"
     T_DOUBLE_QUOTE = "\""
     T_DOLLAR_SIGN = "$"
     T_ELLIPSIS="..."
  ]
}

hackFile ::= T_OPEN_TAG top_statement_list

top_statement_list::= ( statement
                       | function_declaration_statement
                       | class_declaration_statement
                       | enum_declaration_statement
                       | trait_declaration_statement
                       | hh_type_alias_statement
                       | halt_compiler_statement
                       | namespace_statement
                       | use_statement
                       | constant_declaration_statement)*

halt_compiler_statement ::= T_HALT_COMPILER '(' ')' ';'

//Namespaces
namespace_statement ::= (T_NAMESPACE namespace_name ';')
        | (T_NAMESPACE namespace_name '{'  top_statement_list '}')
        | (T_NAMESPACE '{'  top_statement_list '}')

constant_declaration_statement ::= constant_declaration ';'

use_statement::= (T_USE use_declarations ';')
        | (T_USE T_FUNCTION use_fn_declarations ';')
        | (T_USE T_CONST use_const_declarations ';')

ident::= T_STRING
| T_XHP_ATTRIBUTE
| T_XHP_CATEGORY
| T_XHP_CHILDREN
| T_XHP_REQUIRED
| T_ENUM
| T_WHERE
| T_JOIN
| T_ON
| T_IN
| T_EQUALS
| T_INTO
| T_LET
| T_ORDERBY
| T_ASCENDING
| T_DESCENDING
| T_SELECT
| T_GROUP
| T_BY

use_declarations::=  use_declaration (',' use_declaration)*

use_fn_declarations::= use_fn_declaration (',' use_fn_declaration)*

use_const_declarations::= use_const_declaration (',' use_const_declaration)*

use_declaration::= (namespace_name T_AS ident)
        | namespace_name

use_fn_declaration::= (namespace_name T_AS ident)
        | namespace_name

use_const_declaration::=( namespace_name T_AS ident)
        | namespace_name


namespace_name::= T_NS_SEPARATOR? ident (T_NS_SEPARATOR ident)*


namespace_string_base::= (T_NAMESPACE namespace_name)
        | namespace_name

namespace_string::= namespace_string_base

namespace_string_typeargs::= namespace_string_base hh_typeargs_opt

class_namespace_string_typeargs::= namespace_string_base hh_typeargs_opt

constant_assignment::= hh_name_with_type '=' static_expr

constant_declaration::=  T_CONST constant_assignment (',' constant_assignment)*

inner_statement_list::= inner_statement*


inner_statement::= statement
| function_declaration_statement
| class_declaration_statement
| trait_declaration_statement

statement::= ('{' inner_statement_list '}')
| if_statement
| while_statement
| do_while_statement
| for_statement
| switch_statement
| break_statement
| continue_statement
| return_statement
| yield_statement
| global_statement
| static_statement
| echo_statement
| unset_statement
| ';'
| html_statement
| foreach_statement
| declare_statement
| try_statement
| throw_statement
| goto_statement
| expr_statement
| label_statement

if_statement::=  (T_IF parenthesis_expr statement elseif_list else_single)
        |  (T_IF parenthesis_expr ':' inner_statement_list new_elseif_list new_else_single T_ENDIF ';')


while_statement::= T_WHILE parenthesis_expr  while_statement_body


do_while_statement::= T_DO  statement T_WHILE parenthesis_expr ';'


for_statement::= T_FOR '(' for_expr ';' for_expr ';' for_expr ')'  for_statement_body

switch_statement::= T_SWITCH parenthesis_expr  switch_case_list

break_statement::= T_BREAK expr? ';'

continue_statement::= T_CONTINUE expr? ';'

return_statement::= T_RETURN  (expr|query_expr|await_expr)? ';'


yield_statement::= T_YIELD T_BREAK ';'
global_statement::= T_GLOBAL global_var_list ';'
static_statement::= T_STATIC static_var_list ';'
echo_statement::= T_ECHO expr_list ';'
unset_statement::= T_UNSET '(' variable_list ')' ';'

html_statement::= T_INLINE_HTML


foreach_statement::= T_FOREACH '(' expr T_AWAIT? T_AS foreach_variable foreach_optional_arg ')'  foreach_statement_body

declare_statement::=  T_DECLARE '(' declare_list ')' declare_statement_body

try_catch::= T_CATCH '(' fully_qualified_class_name T_VARIABLE ')' '{' inner_statement_list '}'
try_finally ::= T_FINALLY  finally_statement_list

try_statement::= (T_TRY try_statement_list try_catch additional_catches  optional_finally)
        | (T_TRY try_statement_list try_finally)

throw_statement::= T_THROW expr ';'
goto_statement::= T_GOTO ident ';'

expr_statement::= (expr|yield_expr|yield_assign_expr|yield_list_assign_expr|await_expr|await_assign_expr|await_list_assign_expr|query_assign_expr) ';'


try_statement_list::= '{'  inner_statement_list '}'
additional_catches::= try_catch*
finally_statement_list::= '{'  inner_statement_list '}'
optional_finally::= try_finally?



label_statement::= ident ':'
is_reference::= '&'


function_loc::= T_FUNCTION


function_declaration_statement::= function_loc is_reference hh_name_with_typevar  '(' parameter_list ')' hh_opt_return_type function_body


function_declaration_statement::= non_empty_member_modifiers function_loc is_reference hh_name_with_typevar  '(' parameter_list ')' hh_opt_return_type function_body


function_declaration_statement::= non_empty_user_attributes method_modifiers function_loc is_reference hh_name_with_typevar  '(' parameter_list ')' hh_opt_return_type function_body


enum_declaration_statement::= T_ENUM ident  ':' hh_type hh_opt_constraint '{' enum_statement_list '}'


enum_declaration_statement::= non_empty_user_attributes T_ENUM ident  ':' hh_type hh_opt_constraint '{' enum_statement_list '}'


class_declaration_statement::= class_entry_type class_decl_name  extends_from implements_list '{' class_statement_list '}'


class_declaration_statement::= non_empty_user_attributes class_entry_type class_decl_name  extends_from implements_list '{' class_statement_list '}'


class_declaration_statement::= T_INTERFACE interface_decl_name  interface_extends_list '{' class_statement_list '}'


class_declaration_statement::= non_empty_user_attributes T_INTERFACE interface_decl_name  interface_extends_list '{' class_statement_list '}'


trait_declaration_statement::= T_TRAIT trait_decl_name  implements_list '{' class_statement_list '}'


trait_declaration_statement::= non_empty_user_attributes T_TRAIT trait_decl_name  implements_list '{' class_statement_list '}'

class_decl_name::= hh_name_with_typevar
| T_XHP_LABEL

interface_decl_name::= hh_name_with_typevar

trait_decl_name::= hh_name_with_typevar

class_entry_type::= T_CLASS
| T_ABSTRACT T_CLASS
| T_FINAL T_CLASS

extends_from::= T_EXTENDS fully_qualified_class_name


implements_list::= T_IMPLEMENTS interface_list


interface_extends_list::= T_EXTENDS interface_list


interface_list::= fully_qualified_class_name
| interface_list ',' fully_qualified_class_name

trait_list::= fully_qualified_class_name
| trait_list ',' fully_qualified_class_name

foreach_optional_arg::= T_DOUBLE_ARROW foreach_variable


foreach_variable::= variable
| '&' variable
| T_LIST '(' assignment_list ')'

for_statement_body::= statement
| ':' inner_statement_list T_ENDFOR ';'

foreach_statement_body::= statement
| ':' inner_statement_list T_ENDFOREACH ';'

while_statement_body::= statement
| ':' inner_statement_list T_ENDWHILE ';'

declare_statement_body::= statement
| ':' inner_statement_list T_ENDDECLARE ';'

declare_assignment::= ident '=' static_expr

declare_list::=  declare_assignment (',' declare_assignment )*

switch_case_list::= '{' case_list '}'
| '{' ';' case_list '}'
| ':' case_list T_ENDSWITCH ';'
| ':' ';' case_list T_ENDSWITCH ';'

case_block::= T_CASE expr case_separator inner_statement_list
default_case_block::= T_DEFAULT case_separator inner_statement_list

case_list::= (case_block|default_case_block)*


case_separator::= ':' | ';'

elseif_list::=  elseif_body*
elseif_body ::= T_ELSEIF parenthesis_expr statement


new_elseif_list::=  new_elseif_body*
new_elseif_body ::= T_ELSEIF parenthesis_expr ':' inner_statement_list


else_single::= T_ELSE statement


new_else_single::= T_ELSE ':' inner_statement_list

parameter_item::= optional_user_attributes parameter_modifiers hh_type_opt ('&'|"...")? T_VARIABLE ('=' static_expr)?
parameter_list::= parameter_item (',' parameter_item)*  possible_comma


function_call_parameter_list::= non_empty_fcall_parameter_list hh_possible_comma


non_empty_fcall_parameter_list::= expr
| '&' variable
| "..." expr
| non_empty_fcall_parameter_list ',' expr
| non_empty_fcall_parameter_list ',' "..." expr
| non_empty_fcall_parameter_list ',' '&' variable

global_var_list::=     global_var (',' global_var)*

global_var::= T_VARIABLE
| '$' variable
| '$' '{' expr '}'

static_var_list::= (T_VARIABLE | static_assignment) (',' (T_VARIABLE|static_assignment))*
private static_assignment ::= T_VARIABLE '=' static_expr

enum_statement_list::=  enum_statement*


enum_statement::= enum_constant_declaration ';'

enum_constant_declaration::= hh_name_with_type '=' static_expr

class_statement_list::= class_statement_list class_statement



class_statement::= variable_modifiers  class_variable_declaration ';'


class_statement::= non_empty_member_modifiers hh_type  class_variable_declaration ';'
| class_constant_declaration ';'


class_statement::= method_modifiers function_loc is_reference hh_name_with_typevar '('  parameter_list ')' hh_opt_return_type method_body


class_statement::= non_empty_user_attributes method_modifiers function_loc is_reference hh_name_with_typevar '('  parameter_list ')' hh_opt_return_type method_body
| T_XHP_ATTRIBUTE xhp_attribute_stmt ';'
| T_XHP_CATEGORY xhp_category_stmt ';'
| T_XHP_CHILDREN xhp_children_stmt ';'
| T_REQUIRE T_EXTENDS fully_qualified_class_name ';'
| T_REQUIRE T_IMPLEMENTS fully_qualified_class_name ';'
| T_USE trait_list ';'
| T_USE trait_list '{' trait_rules '}'

trait_rules::= trait_rules trait_precedence_rule
| trait_rules trait_alias_rule


trait_precedence_rule::= class_namespace_string_typeargs T_DOUBLE_COLON ident T_INSTEADOF trait_list ';'

trait_alias_rule::= trait_alias_rule_method T_AS method_modifiers ident ';'
| trait_alias_rule_method T_AS non_empty_member_modifiers ';'

trait_alias_rule_method::= class_namespace_string_typeargs T_DOUBLE_COLON ident
| ident

xhp_attribute_stmt::= xhp_attribute_decl
| xhp_attribute_stmt ',' xhp_attribute_decl

xhp_attribute_decl::= xhp_attribute_decl_type xhp_label_ws xhp_attribute_default xhp_attribute_is_required
| T_XHP_LABEL

xhp_attribute_decl_type::= T_ARRAY
| fully_qualified_class_name
| T_VAR
| T_ENUM '{' xhp_attribute_enum '}'
| T_CALLABLE

xhp_attribute_enum::= common_scalar
| xhp_attribute_enum ',' common_scalar

xhp_attribute_default::= '=' static_expr


xhp_attribute_is_required::= '@' T_XHP_REQUIRED


xhp_category_stmt::= xhp_category_decl
| xhp_category_stmt ',' xhp_category_decl

xhp_category_decl::= T_XHP_CATEGORY_LABEL

xhp_children_stmt::= xhp_children_paren_expr
| ident
| T_EMPTY

xhp_children_paren_expr::= '(' xhp_children_decl_expr ')'
| '(' xhp_children_decl_expr ')' '*'
| '(' xhp_children_decl_expr ')' '?'
| '(' xhp_children_decl_expr ')' '+'

xhp_children_decl_expr::= xhp_children_paren_expr
| xhp_children_decl_tag
| xhp_children_decl_tag '*'
| xhp_children_decl_tag '?'
| xhp_children_decl_tag '+'
| xhp_children_decl_expr ',' xhp_children_decl_expr
| xhp_children_decl_expr '|' xhp_children_decl_expr

xhp_children_decl_tag::= ident
| T_XHP_LABEL
| T_XHP_CATEGORY_LABEL

function_body::= ';'
| '{' inner_statement_list '}'

method_body::= ';'
| '{' inner_statement_list '}'

variable_modifiers::= non_empty_member_modifiers
| T_VAR

method_modifiers::= non_empty_member_modifiers


non_empty_member_modifiers::= member_modifier
| non_empty_member_modifiers member_modifier

member_modifier::= T_PUBLIC
| T_PROTECTED
| T_PRIVATE
| T_STATIC
| T_ABSTRACT
| T_FINAL
| T_ASYNC

parameter_modifiers::= parameter_modifier


parameter_modifier::= T_PUBLIC
| T_PROTECTED
| T_PRIVATE

class_variable_declaration::= class_variable_declaration ',' T_VARIABLE
| class_variable_declaration ',' static_assignment
| T_VARIABLE
| static_assignment

class_constant_declaration::= class_constant_declaration ',' hh_name_with_type '=' static_expr
| T_CONST hh_name_with_type '=' static_expr

expr_with_parens::= '(' expr_with_parens ')'
| T_NEW class_name_reference ctor_arguments
| T_CLONE expr
| xhp_tag
| collection_literal

parenthesis_expr::= '(' expr ')'

expr_list::= expr (',' expr)*

for_expr::= expr_list


yield_expr::= T_YIELD expr
| T_YIELD expr T_DOUBLE_ARROW expr

yield_assign_expr::= variable '=' yield_expr

yield_list_assign_expr::= T_LIST '(' assignment_list ')' '=' yield_expr

await_expr::= T_AWAIT expr

await_assign_expr::= variable '=' await_expr

await_list_assign_expr::= T_LIST '(' assignment_list ')' '=' await_expr

expr::= expr_no_variable
| variable
| expr_with_parens

expr_no_variable::= T_LIST '(' assignment_list ')' '=' expr
| variable '=' expr
| variable '=' '&' variable
| variable '=' '&' T_NEW class_name_reference ctor_arguments
| variable T_PLUS_EQUAL expr
| variable T_MINUS_EQUAL expr
| variable T_MUL_EQUAL expr
| variable T_DIV_EQUAL expr
| variable T_CONCAT_EQUAL expr
| variable T_MOD_EQUAL expr
| variable T_AND_EQUAL expr
| variable T_OR_EQUAL expr
| variable T_XOR_EQUAL expr
| variable T_SL_EQUAL expr
| variable T_SR_EQUAL expr
| variable T_POW_EQUAL expr
| variable T_INC
| T_INC variable
| variable T_DEC
| T_DEC variable
| expr T_BOOLEAN_OR expr
| expr T_BOOLEAN_AND expr
| expr T_LOGICAL_OR expr
| expr T_LOGICAL_AND expr
| expr T_LOGICAL_XOR expr
| expr '|' expr
| expr '&' expr
| expr '^' expr
| expr '.' expr
| expr '+' expr
| expr '-' expr
| expr '*' expr
| expr '/' expr
| expr T_POW expr
| expr '%' expr
| expr T_SL expr
| expr T_SR expr
| '+' expr
| '-' expr
| '!' expr
| '~' expr
| expr T_IS_IDENTICAL expr
| expr T_IS_NOT_IDENTICAL expr
| expr T_IS_EQUAL expr
| expr T_IS_NOT_EQUAL expr
| expr '<' expr
| expr T_IS_SMALLER_OR_EQUAL expr
| expr '>' expr
| expr T_IS_GREATER_OR_EQUAL expr
| expr T_INSTANCEOF class_name_reference
| '(' expr_no_variable ')'
| expr '?' expr ':' expr
| expr '?' ':' expr
| internal_functions
| T_INT_CAST expr
| T_DOUBLE_CAST expr
| T_STRING_CAST expr
| T_ARRAY_CAST expr
| T_OBJECT_CAST expr
| T_BOOL_CAST expr
| T_UNSET_CAST expr
| T_EXIT exit_expr
| '@' expr
| scalar
| array_literal
| shape_literal
| map_array_literal
| varray_literal
| '`' backticks_expr '`'
| T_PRINT expr
| closure_expression
| lambda_expression
| dim_expr

lambda_use_vars::= T_USE '(' lexical_var_list hh_possible_comma ')'



closure_expression::= function_loc is_reference '('  parameter_list ')' hh_opt_return_type lambda_use_vars '{' inner_statement_list '}'


closure_expression::= non_empty_member_modifiers function_loc is_reference '('  parameter_list ')' hh_opt_return_type lambda_use_vars '{' inner_statement_list '}'


lambda_expression::= T_VARIABLE  lambda_body


lambda_expression::= T_ASYNC T_VARIABLE  lambda_body


lambda_expression::= T_LAMBDA_OP  parameter_list T_LAMBDA_CP hh_opt_return_type lambda_body


lambda_expression::= T_ASYNC T_LAMBDA_OP  parameter_list T_LAMBDA_CP hh_opt_return_type lambda_body

lambda_body::= T_LAMBDA_ARROW expr
| T_LAMBDA_ARROW await_expr
| T_LAMBDA_ARROW '{' inner_statement_list '}'

shape_keyname::= T_CONSTANT_ENCAPSED_STRING
| class_constant

non_empty_shape_pair_list::= non_empty_shape_pair_list ',' shape_keyname T_DOUBLE_ARROW expr
| shape_keyname T_DOUBLE_ARROW expr

non_empty_static_shape_pair_list::= non_empty_static_shape_pair_list ',' shape_keyname T_DOUBLE_ARROW static_expr
| shape_keyname T_DOUBLE_ARROW static_expr

shape_pair_list::= non_empty_shape_pair_list possible_comma


static_shape_pair_list::= non_empty_static_shape_pair_list possible_comma


shape_literal::= T_SHAPE '(' shape_pair_list ')'

array_literal::= T_ARRAY '(' array_pair_list ')'
| '[' array_pair_list ']'

collection_literal::= fully_qualified_class_name '{' collection_init '}'

map_array_literal::= T_MIARRAY '(' map_array_init ')'
| T_MSARRAY '(' map_array_init ')'

varray_literal::= T_VARRAY '(' varray_init ')'

static_map_array_literal::= T_MIARRAY '(' static_map_array_init ')'
| T_MSARRAY '(' static_map_array_init ')'

static_varray_literal::= T_VARRAY '(' static_varray_init ')'

static_collection_literal::= fully_qualified_class_name '{' static_collection_init '}'

dim_expr::= dim_expr '[' dim_offset ']'
| dim_expr_base '[' dim_offset ']'

dim_expr_base::= array_literal
| class_constant
| T_CONSTANT_ENCAPSED_STRING
| '(' expr_no_variable ')'

query_expr::= query_head query_body

query_assign_expr::= variable '=' query_expr

query_head::= T_FROM T_VARIABLE T_IN expr

query_body::= query_body_clauses select_or_group_clause
| query_body_clauses select_or_group_clause query_continuation
| select_or_group_clause
| select_or_group_clause query_continuation

query_body_clauses::= query_body_clause
| query_body_clauses query_body_clause

query_body_clause::= from_clause
| let_clause
| where_clause
| join_clause
| join_into_clause
| orderby_clause

from_clause::= T_FROM T_VARIABLE T_IN expr

let_clause::= T_LET T_VARIABLE '=' expr

where_clause::= T_WHERE expr

join_clause::= T_JOIN T_VARIABLE T_IN expr T_ON expr T_EQUALS expr

join_into_clause::= T_JOIN T_VARIABLE T_IN expr T_ON expr T_EQUALS expr T_INTO T_VARIABLE

orderby_clause::= T_ORDERBY orderings

orderings::= ordering
| orderings ',' ordering

ordering::= expr
| expr ordering_direction

ordering_direction::= T_ASCENDING
| T_DESCENDING

select_or_group_clause::= select_clause
| group_clause

select_clause::= T_SELECT expr

group_clause::= T_GROUP expr T_BY expr

query_continuation::= T_INTO T_VARIABLE query_body

lexical_var_list::= lexical_var_list ',' T_VARIABLE
| lexical_var_list ',' '&' T_VARIABLE
| T_VARIABLE
| '&' T_VARIABLE

xhp_tag::= T_XHP_TAG_LT T_XHP_LABEL xhp_tag_body T_XHP_TAG_GT

xhp_tag_body::= xhp_attributes '/'
| xhp_attributes T_XHP_TAG_GT xhp_children T_XHP_TAG_LT '/' xhp_opt_end_label

xhp_opt_end_label::= {T_XHP_LABEL}

xhp_attributes::= xhp_attributes xhp_attribute_name '=' xhp_attribute_value


xhp_children::= xhp_children xhp_child


xhp_attribute_name::= T_XHP_LABEL

xhp_attribute_value::= T_XHP_TEXT
| '{' expr '}'

xhp_child::= T_XHP_TEXT
| '{' expr '}'
| xhp_tag

xhp_label_ws::= xhp_bareword
| xhp_label_ws ':' xhp_bareword
| xhp_label_ws '-' xhp_bareword

xhp_bareword::= ident
| T_EXIT
| T_FUNCTION
| T_CONST
| T_RETURN
| T_YIELD
| T_AWAIT
| T_TRY
| T_CATCH
| T_FINALLY
| T_THROW
| T_IF
| T_ELSEIF
| T_ENDIF
| T_ELSE
| T_WHILE
| T_ENDWHILE
| T_DO
| T_FOR
| T_ENDFOR
| T_FOREACH
| T_ENDFOREACH
| T_DECLARE
| T_ENDDECLARE
| T_INSTANCEOF
| T_AS
| T_SWITCH
| T_ENDSWITCH
| T_CASE
| T_DEFAULT
| T_BREAK
| T_CONTINUE
| T_GOTO
| T_ECHO
| T_PRINT
| T_CLASS
| T_INTERFACE
| T_EXTENDS
| T_IMPLEMENTS
| T_NEW
| T_CLONE
| T_VAR
| T_EVAL
| T_INCLUDE
| T_INCLUDE_ONCE
| T_REQUIRE
| T_REQUIRE_ONCE
| T_NAMESPACE
| T_USE
| T_GLOBAL
| T_ISSET
| T_EMPTY
| T_HALT_COMPILER
| T_STATIC
| T_ABSTRACT
| T_FINAL
| T_PRIVATE
| T_PROTECTED
| T_PUBLIC
| T_ASYNC
| T_UNSET
| T_LIST
| T_ARRAY
| T_LOGICAL_OR
| T_LOGICAL_AND
| T_LOGICAL_XOR
| T_CLASS_C
| T_FUNC_C
| T_METHOD_C
| T_LINE
| T_FILE
| T_DIR
| T_NS_C
| T_COMPILER_HALT_OFFSET
| T_TRAIT
| T_TRAIT_C
| T_INSTEADOF
| T_TYPE
| T_NEWTYPE
| T_SHAPE

simple_function_call::= namespace_string_typeargs '(' function_call_parameter_list ')'

fully_qualified_class_name::= class_namespace_string_typeargs
| T_XHP_LABEL

static_class_name::= fully_qualified_class_name
| T_STATIC
| reference_variable

class_name_reference::= fully_qualified_class_name
| T_STATIC
| variable_no_calls

exit_expr::= '(' ')'
| parenthesis_expr


backticks_expr::= /* empty */
| T_ENCAPSED_AND_WHITESPACE
| encaps_list

ctor_arguments::= '(' function_call_parameter_list ')'


common_scalar::= T_LNUMBER
| T_DNUMBER
| T_ONUMBER
| T_CONSTANT_ENCAPSED_STRING
| T_LINE
| T_FILE
| T_DIR
| T_CLASS_C
| T_TRAIT_C
| T_METHOD_C
| T_FUNC_C
| T_NS_C
| T_COMPILER_HALT_OFFSET
| T_START_HEREDOC T_ENCAPSED_AND_WHITESPACE T_END_HEREDOC
| T_START_HEREDOC T_END_HEREDOC

static_expr::= common_scalar
| namespace_string
| T_ARRAY '(' static_array_pair_list ')'
| '[' static_array_pair_list ']'
| T_SHAPE '(' static_shape_pair_list ')'
| static_class_constant
| static_collection_literal
| static_map_array_literal
| static_varray_literal
| '(' static_expr ')'
| static_expr T_BOOLEAN_OR static_expr
| static_expr T_BOOLEAN_AND static_expr
| static_expr T_LOGICAL_OR static_expr
| static_expr T_LOGICAL_AND static_expr
| static_expr T_LOGICAL_XOR static_expr
| static_expr '|' static_expr
| static_expr '&' static_expr
| static_expr '^' static_expr
| static_expr '.' static_expr
| static_expr '+' static_expr
| static_expr '-' static_expr
| static_expr '*' static_expr
| static_expr '/' static_expr
| static_expr '%' static_expr
| static_expr T_SL static_expr
| static_expr T_SR static_expr
| static_expr T_POW static_expr
| '!' static_expr
| '~' static_expr
| '+' static_expr
| '-' static_expr
| static_expr T_IS_IDENTICAL static_expr
| static_expr T_IS_NOT_IDENTICAL static_expr
| static_expr T_IS_EQUAL static_expr
| static_expr T_IS_NOT_EQUAL static_expr
| static_expr '<' static_expr
| static_expr T_IS_SMALLER_OR_EQUAL static_expr
| static_expr '>' static_expr
| static_expr T_IS_GREATER_OR_EQUAL static_expr
| static_expr '?' static_expr ':' static_expr
| static_expr '?' ':' static_expr

static_class_constant::= class_namespace_string_typeargs T_DOUBLE_COLON ident
| T_XHP_LABEL T_DOUBLE_COLON ident
| class_namespace_string_typeargs T_DOUBLE_COLON T_CLASS

scalar::= namespace_string
| T_STRING_VARNAME
| class_constant
| common_scalar
| '"' encaps_list '"'
| "'" encaps_list "'"
| T_START_HEREDOC encaps_list T_END_HEREDOC

static_array_pair_list::= non_empty_static_array_pair_list possible_comma


possible_comma::= ','?


hh_possible_comma::= ','?


non_empty_static_array_pair_list::= non_empty_static_array_pair_list ',' static_expr T_DOUBLE_ARROW static_expr
| non_empty_static_array_pair_list ',' static_expr
| static_expr T_DOUBLE_ARROW static_expr
| static_expr

common_scalar_ae::= T_LNUMBER
| T_DNUMBER
| T_ONUMBER
| T_CONSTANT_ENCAPSED_STRING
| T_START_HEREDOC T_ENCAPSED_AND_WHITESPACE T_END_HEREDOC
| T_START_HEREDOC T_END_HEREDOC

static_numeric_scalar_ae::= T_LNUMBER
| T_DNUMBER
| T_ONUMBER
| ident

static_scalar_ae::= common_scalar_ae
| ident
| '+' static_numeric_scalar_ae
| '-' static_numeric_scalar_ae
| T_ARRAY '(' static_array_pair_list_ae ')'
| '[' static_array_pair_list_ae ']'
| T_SHAPE '(' static_shape_pair_list_ae ')'

static_array_pair_list_ae::= non_empty_static_array_pair_list_ae possible_comma


non_empty_static_array_pair_list_ae::= non_empty_static_array_pair_list_ae ',' static_scalar_ae T_DOUBLE_ARROW static_scalar_ae
| non_empty_static_array_pair_list_ae ',' static_scalar_ae
| static_scalar_ae T_DOUBLE_ARROW static_scalar_ae
| static_scalar_ae

non_empty_static_scalar_list_ae::= non_empty_static_scalar_list_ae ',' static_scalar_ae
| static_scalar_ae

static_shape_pair_list_ae::= non_empty_static_shape_pair_list_ae possible_comma


non_empty_static_shape_pair_list_ae::= non_empty_static_shape_pair_list_ae ',' shape_keyname T_DOUBLE_ARROW static_scalar_ae
| shape_keyname T_DOUBLE_ARROW static_scalar_ae

static_scalar_list_ae::= non_empty_static_scalar_list_ae possible_comma


attribute_static_scalar_list::= '(' static_scalar_list_ae ')'


non_empty_user_attribute_list::= non_empty_user_attribute_list ',' ident attribute_static_scalar_list
| ident attribute_static_scalar_list


user_attribute_list::=  non_empty_user_attribute_list possible_comma

non_empty_user_attributes::= T_SL user_attribute_list T_SR

optional_user_attributes::= non_empty_user_attributes*


property_access::= property_access_without_variables
| T_OBJECT_OPERATOR variable_without_objects

property_access_without_variables::= T_OBJECT_OPERATOR ident
| T_OBJECT_OPERATOR '{' expr '}'

array_access::= '[' dim_offset ']'
| '{' expr '}'

dimmable_variable_access::= dimmable_variable array_access
| '(' expr_with_parens ')' array_access

dimmable_variable_no_calls_access::= dimmable_variable_no_calls array_access
| '(' expr_with_parens ')' array_access

variable::= variable_without_objects
| simple_function_call
| object_method_call
| class_method_call
| dimmable_variable_access
| variable property_access
| '(' expr_with_parens ')' property_access
| static_class_name T_DOUBLE_COLON variable_without_objects
| callable_variable '(' function_call_parameter_list ')'
| '(' variable ')'

dimmable_variable::= simple_function_call
| object_method_call
| class_method_call
| dimmable_variable_access
| variable property_access_without_variables
| '(' expr_with_parens ')' property_access_without_variables
| callable_variable '(' function_call_parameter_list ')'
| '(' variable ')'

callable_variable::= variable_without_objects
| dimmable_variable_access
| '(' variable ')'

object_method_call::= variable T_OBJECT_OPERATOR ident hh_typeargs_opt '(' function_call_parameter_list ')'
| variable T_OBJECT_OPERATOR variable_without_objects '(' function_call_parameter_list ')'
| variable T_OBJECT_OPERATOR '{' expr '}' '(' function_call_parameter_list ')'
| '(' expr_with_parens ')' T_OBJECT_OPERATOR ident hh_typeargs_opt '(' function_call_parameter_list ')'
| '(' expr_with_parens ')' T_OBJECT_OPERATOR variable_without_objects '(' function_call_parameter_list ')'
| '(' expr_with_parens ')' T_OBJECT_OPERATOR '{' expr '}' '(' function_call_parameter_list ')'

class_method_call::= static_class_name T_DOUBLE_COLON ident hh_typeargs_opt '(' function_call_parameter_list ')'
| static_class_name T_DOUBLE_COLON variable_without_objects '(' function_call_parameter_list ')'
| static_class_name T_DOUBLE_COLON '{' expr '}' '(' function_call_parameter_list ')'

variable_without_objects::= reference_variable
| simple_indirect_reference reference_variable

reference_variable::= reference_variable '[' dim_offset ']'
| reference_variable '{' expr '}'
| compound_variable

compound_variable::= T_VARIABLE
| '$' '{' expr '}'

dim_offset::= expr


simple_indirect_reference::= '$'
| simple_indirect_reference '$'

variable_no_calls::= variable_without_objects
| dimmable_variable_no_calls_access
| variable_no_calls property_access
| '(' expr_with_parens ')' property_access
| static_class_name T_DOUBLE_COLON variable_without_objects
| '(' variable ')'

dimmable_variable_no_calls::= /* empty */
| dimmable_variable_no_calls_access
| variable_no_calls property_access_without_variables
| '(' expr_with_parens ')' property_access_without_variables
| '(' variable ')'

assignment_list::= assignment_list ','
| assignment_list ',' variable
| assignment_list ',' T_LIST '(' assignment_list ')'

| variable
| T_LIST '(' assignment_list ')'

array_pair_list::= non_empty_array_pair_list possible_comma


non_empty_array_pair_list::= non_empty_array_pair_list ',' expr T_DOUBLE_ARROW expr
| non_empty_array_pair_list ',' expr
| expr T_DOUBLE_ARROW expr
| expr
| non_empty_array_pair_list ',' expr T_DOUBLE_ARROW '&' variable
| non_empty_array_pair_list ',' '&' variable
| expr T_DOUBLE_ARROW '&' variable
| '&' variable

collection_init::= non_empty_collection_init possible_comma


non_empty_collection_init::= non_empty_collection_init ',' expr T_DOUBLE_ARROW expr
| non_empty_collection_init ',' expr
| expr T_DOUBLE_ARROW expr
| expr

static_collection_init::= non_empty_static_collection_init possible_comma


non_empty_static_collection_init::= non_empty_static_collection_init ',' static_expr T_DOUBLE_ARROW static_expr
| non_empty_static_collection_init ',' static_expr
| static_expr T_DOUBLE_ARROW static_expr
| static_expr

map_array_init::= non_empty_map_array_init possible_comma


varray_init::= non_empty_varray_init possible_comma


non_empty_map_array_init::= non_empty_map_array_init ',' expr T_DOUBLE_ARROW expr
| expr T_DOUBLE_ARROW expr

non_empty_varray_init::= non_empty_varray_init ',' expr
| expr

static_map_array_init::= non_empty_static_map_array_init possible_comma


static_varray_init::= non_empty_static_varray_init possible_comma


non_empty_static_map_array_init::= non_empty_static_map_array_init ',' static_expr T_DOUBLE_ARROW static_expr
| static_expr T_DOUBLE_ARROW static_expr

non_empty_static_varray_init::= non_empty_static_varray_init ',' static_expr
| static_expr

encaps_list::= encaps_list encaps_var
| encaps_list T_ENCAPSED_AND_WHITESPACE
| encaps_var
| T_ENCAPSED_AND_WHITESPACE encaps_var

encaps_var::= T_VARIABLE
| T_VARIABLE '[' encaps_var_offset ']'
| T_VARIABLE T_OBJECT_OPERATOR ident
| T_DOLLAR_OPEN_CURLY_BRACES expr '}'
| T_DOLLAR_OPEN_CURLY_BRACES T_STRING_VARNAME '[' expr ']' '}'
| T_CURLY_OPEN variable '}'

encaps_var_offset::= ident
| T_NUM_STRING
| T_VARIABLE

internal_functions::= T_ISSET '(' variable_list ')'
| T_EMPTY '(' variable ')'
| T_EMPTY '(' expr_no_variable ')'
| T_EMPTY '(' expr_with_parens ')'
| T_INCLUDE expr
| T_INCLUDE_ONCE expr
| T_EVAL '(' expr ')'
| T_REQUIRE expr
| T_REQUIRE_ONCE expr

variable_list::= (variable (',' variable)*)?

class_constant::= static_class_name T_DOUBLE_COLON ident
| static_class_name T_DOUBLE_COLON T_CLASS

hh_opt_constraint::= /* empty */
| T_AS hh_type

hh_type_alias_statement::= T_TYPE hh_name_with_typevar '=' hh_type ';'
| T_NEWTYPE hh_name_with_typevar hh_opt_constraint '=' hh_type ';'

hh_name_with_type::= ident
| hh_type ident

hh_name_with_typevar::= ident
| ident T_TYPELIST_LT hh_typevar_list T_TYPELIST_GT

hh_typeargs_opt::= T_TYPELIST_LT hh_type_list T_TYPELIST_GT


hh_non_empty_type_list::= hh_type
| hh_non_empty_type_list ',' hh_type

hh_type_list::= hh_non_empty_type_list possible_comma

hh_func_type_list::= hh_non_empty_type_list ',' "..."
| hh_type_list
| "..."


hh_opt_return_type::= (':' hh_type)?

hh_typevar_list::= hh_typevar_list ',' hh_typevar_variance ident
| hh_typevar_variance ident
| hh_typevar_list ',' hh_typevar_variance ident T_AS hh_type
| hh_typevar_variance ident T_AS hh_type

hh_typevar_variance::= '+' | '-'


hh_shape_member_type::= T_CONSTANT_ENCAPSED_STRING T_DOUBLE_ARROW hh_type
| class_namespace_string_typeargs T_DOUBLE_COLON ident T_DOUBLE_ARROW hh_type

hh_non_empty_shape_member_list::= hh_non_empty_shape_member_list ',' hh_shape_member_type
| hh_shape_member_type

hh_shape_member_list::= hh_non_empty_shape_member_list possible_comma


hh_shape_type::= T_SHAPE '(' hh_shape_member_list ')'

hh_null_type ::= '?' hh_type

//TODO: Separate this Section
hh_type::= hh_null_type
| '@' hh_type
| class_namespace_string_typeargs
| T_ARRAY
| T_CALLABLE
| hh_shape_type
| T_ARRAY T_TYPELIST_LT hh_type T_TYPELIST_GT
| T_ARRAY T_TYPELIST_LT hh_type ',' hh_type T_TYPELIST_GT
| T_XHP_LABEL
| '(' T_FUNCTION '(' hh_func_type_list ')' ':' hh_type ')'
| '(' hh_type ',' hh_non_empty_type_list possible_comma ')'

hh_type_opt::= hh_type

